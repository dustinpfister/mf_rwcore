
var rw=(function(){var x=0,y=0;var distTick=function(obj){var roll,d=this.d,per;d.d=_.d(0,0,obj.x+obj.w/2,obj.y+obj.w/2);d.hellPer=(d.d-d.safeDist)/d.hellDist;if(d.hellPer<0){d.hellPer=0;}
if(d.hellPer>1){d.hellPer=1;}
d.spawnRate=Math.floor(30000-30000*d.hellPer);if(new Date()-d.lastSpawn>=d.spawnRate){roll=_.r();if(roll<d.hellPer){this.es.addShip({x:this.ps.units[0].x+200,y:this.ps.units[0].y,delta:Math.floor(3.5*d.hellPer+.5)});}
this.d.lastSpawn=new Date();}};var makeRing=function(d,c){var sec,x,y,r,i=0;d=d||1000;c=c||10;while(i<c){r=_.tau/c*i;x=Math.cos(r)*d-64;y=Math.sin(r)*d-64;sec=S.getPos(x,y);sec.pl.push(new Planet({x:x,y:y}));i+=1;}};var onPl=function(sec,obj){var i;if(sec){if(sec.pl){i=sec.pl.length;while(i--){if(_.b(sec.pl[i],obj)){return sec.pl[i];}}}}
return false;};var Planet=function(obj){obj=obj||{};Unit.call(this,obj);this.w=128;this.h=128;this.hw=64;this.hh=64;this.f='#00ffaf';};Planet.prototype=new Unit();api={d:{safeDist:1000,hellDist:50000,spawnRate:30000,lastSpawn:new Date()},ps:{},es:{},cp:{},init:function(){_.l('rw-core: init...');vp.w=640;vp.h=480;C.canvas.width=640;C.canvas.height=480;C.cls();S.set(1280,960,20,20);S.ls(vp.x,vp.y,vp.w,vp.h);this.d.hellDist=S.H/2*S.sh;S.secs.forEach(function(sec){sec.pl=[];});var sec=S.getPos(-32,-32);sec.pl.push(new Planet({x:-64,y:-64}));makeRing(this.d.safeDist,20);makeRing(9000,250);this.ps=new ShipCollection({faction:'p',max:1});this.ps.addShip();this.es=new ShipCollection({faction:'e',ai:true,max:5});this.ps.enemys=this.es;this.es.enemys=this.ps;_.l(this.ps)},tick:function(){var obj=this.ps.units[0];distTick.call(this,obj);var d=kc.d();if(d>=0){if(_.asd(obj.a,d)==-1){obj.a-=Math.PI/100;}else{obj.a+=Math.PI/100;}
obj.step();}
vp.x=obj.x-vp.w/2;vp.y=obj.y-vp.h/2;S.ls(vp.x,vp.y,vp.w,vp.h);if(kc.keys[186]){obj.shoot();}
if(kc.keys[49]){this.ps.ai=true;}
if(kc.keys[50]){this.ps.ai=false;}
var pl=onPl(S.getPos(obj.x,obj.y),obj);this.cp={};if(pl){this.cp=pl;}
this.ps.update();this.es.update();}};return api;}
());